

    /// <summary>
    /// %N% CRUD
    /// </summary>
    [RoutePrefix('api/%N%')]
    public class %N%Controller : BaseApiController
    {
        /// <summary>
        /// Search, Page, filter and Shaped %N%
        /// </summary>
        /// <param name='sort'></param>
        %D%/// <param name='page'></param>
        /// <param name='pageSize'></param>
        /// <param name='fields'></param>
        /// <param name='draw'></param>
        /// <returns></returns>
        [ResponseType(typeof(IEnumerable<%H%Model>))]
        [Route('Search', Name = '%H%Api')]
        [HttpGet]
        public IHttpActionResult Get(string sort = 'id', %P%, long page = 1, long pageSize = 10, string fields= '', int draw = 1)
        {  
            try
            {
                var items = Logic.%H%Service.SearchView(%V%,page, pageSize, sort);
                
                if (page > items.TotalPages) page = items.TotalPages;
                var jo = new JObjectHelper(); 
                %J%
                jo.Add('fields', fields); 
                jo.Add('sort', sort);
                var urlHelper = new UrlHelper(Request);
                var linkBuilder = new PageLinkBuilder(urlHelper, '%H%Api', jo, page, pageSize, items.TotalItems, draw); 
                AddHeader('X-Pagination', linkBuilder.PaginationHeader);
                var dto = new List<%H%Model>();
                if (items.TotalItems <= 0) return Ok(dto); 
                var dtos = items.Items.ShapeList(fields);
                return Ok(dtos);
            }
            catch(Exception ex)
            {
                Log.Error(ex);
                return BadRequest(ex.Message);
            }
        }
        
        /// <summary>
        /// Get %H% by ID
        /// </summary>
        /// <param name='id'></param>
        /// <returns></returns>
        [HttpGet]
        [Route('Detail')]
        [ResponseType(typeof(%H%Model))]
        public IHttpActionResult Get(%T% id)
        {
            try
            {
                var item = Logic.%H%Service.GetModel(id);
                if (item == null)
                {
                    return NotFound();
                }
                return Ok(item);
            }
            catch(Exception ex)
            {
                Log.Error(ex);
                return BadRequest(ex.Message);
            }
        }

         /// <summary>
        /// Add %H%
        /// </summary>
        /// <param name='form'></param>
        /// <returns></returns>
        [Route('Create')]
        [HttpPost]
        [ResponseType(typeof(%H%Model))]
        public IHttpActionResult Create(%H%Form form)
        {
            try
            {
                var model = Logic.%H%Service.Create(form);
                var check = Logic.%H%Service.CreateExists(model);
                if (check)
                {
                    return BadRequest('%H% already exists');
                }
                var dto = Logic.%H%Service.Insert(model);
                return Ok(dto);
            }
            catch (Exception ex)
            {
                Log.Error(ex);
                return BadRequest(ex.Message);
            }
        }

                /// <summary>
        /// Update %H%
        /// </summary>
        /// <param name='id'></param>
        /// <param name='form'></param>
        /// <returns></returns>
        [Route('Update')]
        [HttpPost]
        [ResponseType(typeof(%H%Model))]
        public IHttpActionResult Update(%T% id, %H%Form form)
        {
            try
            {
                var model = Logic.%H%Service.Create(form);
                if (id != model.Id)
                    return BadRequest('Route Parameter does mot match model ID'); 
                var found = Logic.%H%Service.Get(id);
                if (found == null)
                    return NotFound(); 
                var check = Logic.%H%Service.UpdateExists(model); 
                if (Logic.%H%Service.UpdateExists(model))
                    return BadRequest('%H% configuration already exists');
                var dto = Logic.%H%Service.Update(found, model,
                    '%U%,RecordStatus');
                return Ok(dto);
            } 
            catch (Exception ex)
            {
                Log.Error(ex);
                return BadRequest(ex.Message);
            }
        }

        /// <summary>
        /// Delete %H%
        /// </summary>
        /// <param name='id'></param>
        /// <returns></returns>
        [Route('Delete')]
        [HttpPost]
        [ResponseType(typeof(%H%Model))]
        public IHttpActionResult Delete(%T% id)
        {
            try
            {
                var found = Logic.%H%Service.Get(id);
                if (found == null)
                    return NotFound();
                Logic.%H%Service.Delete(found); 
                return Content(HttpStatusCode.NoContent,found);
            } 
            catch (Exception ex)
            {
                Log.Error(ex);
                return BadRequest(ex.Message);
            }
        } 
    }
